/**
 * @file validations.ts
 * @description Схемы валидации входных данных на основе библиотеки Zod.
 *
 * Все Server Actions принимают `FormData`, где все значения — строки.
 * Zod позволяет описать ожидаемую форму данных и автоматически:
 *   1. Проверить типы и ограничения (min/max длина, формат email и т.д.).
 *   2. Сообщить об ошибках с понятными сообщениями.
 *   3. Вернуть данные с правильными TypeScript-типами (type-narrowing).
 *
 * Использование: `schema.safeParse(rawData)` — не бросает исключение,
 * а возвращает `{ success: true, data }` или `{ success: false, error }`.
 */

import { z } from "zod";

// ---------------------------------------------------------------------------
// Схемы для работы с товарами (Item)
// ---------------------------------------------------------------------------

/**
 * Схема для создания нового товара в списке.
 * Используется в Server Action `addItem`.
 */
export const createItemSchema = z.object({
  /**
   * Название товара.
   * Минимум 1 символ (не пустое), максимум 100 символов (защита от спама).
   */
  itemName: z.string().min(1).max(100),

  /**
   * ID списка, к которому привязывается товар.
   * Должен быть строкой (CUID, генерируется Prisma).
   */
  listId: z.string(),
});

/**
 * Схема для удаления товара.
 * Используется в Server Action `deleteItem`.
 */
export const deleteItemSchema = z.object({
  /** Уникальный идентификатор удаляемого товара. */
  itemId: z.string(),
});

/**
 * Схема для переключения статуса товара (куплен / не куплен).
 * Используется в Server Action `toggleItem`.
 *
 * Важно: FormData всегда передаёт строки, поэтому перед передачей
 * в эту схему значение `isCompleted` нужно явно преобразовать:
 * `formData.get("isCompleted") === "true"`.
 */
export const toggleItemSchema = z.object({
  /** Уникальный идентификатор товара, чей статус меняется. */
  itemId: z.string(),
  /** Текущий статус товара (до переключения). Передаётся как boolean. */
  isCompleted: z.boolean(),
});

// ---------------------------------------------------------------------------
// Схемы для работы со списками покупок (ShoppingList)
// ---------------------------------------------------------------------------

/**
 * Схема для создания нового списка покупок.
 * Используется в Server Action `createList`.
 */
export const createListSchema = z.object({
  /**
   * Название списка.
   * Обязательное поле. Максимум 50 символов.
   */
  title: z
    .string()
    .min(1, "Название обязательно")
    .max(50, "Слишком длинное название"),
});

/**
 * Схема для удаления списка покупок.
 * Используется в Server Action `deleteList`.
 */
export const deleteListSchema = z.object({
  /** Уникальный идентификатор удаляемого списка. */
  listId: z.string(),
});

/**
 * Схема для предоставления совместного доступа к списку.
 * Используется в Server Action `shareList`.
 */
export const shareListSchema = z.object({
  /** ID списка, которым делятся. */
  listId: z.string(),
  /**
   * Email пользователя, которого приглашают.
   * `.trim()` удаляет пробелы по краям до валидации email.
   * `.pipe(z.email(...))` проверяет корректность формата.
   */
  email: z.string().trim().pipe(z.email("Введите корректный email")),
});

/**
 * Схема для удаления пользователя из совместного доступа к списку.
 * Используется в Server Action `removeSharedUser`.
 */
export const removeSharedUserSchema = z.object({
  /** ID списка, из которого убирают доступ. */
  listId: z.string(),
  /** ID пользователя, которого убирают из доступа. */
  userId: z.string(),
});

/**
 * Схема для переименования списка покупок.
 * Используется в Server Action `renameList`.
 */
export const renameListSchema = z.object({
  /** Уникальный идентификатор переименовываемого списка. */
  listId: z.string(),
  /**
   * Новое название списка.
   * Обязательное поле. Максимум 50 символов.
   */
  title: z
    .string()
    .min(1, "Название обязательно")
    .max(50, "Слишком длинное название"),
});

/**
 * Схема для переименования товара в списке.
 * Используется в Server Action `renameItem`.
 */
export const renameItemSchema = z.object({
  /** Уникальный идентификатор переименовываемого товара. */
  itemId: z.string(),
  /**
   * Новое название товара.
   * Обязательное поле. Максимум 100 символов.
   */
  itemName: z
    .string()
    .min(1, "Название обязательно")
    .max(100, "Слишком длинное название"),
});
